<h1 class="text-center mt-3">Goal info</h1>
<div class="col-sm-12 col-md-4 offset-md-4 mb-3 p-3 goal-info" style="font-size: large">
  <dl class="row">
    <dt class="col-sm-3">Category:</dt>
    <dd class="col-sm-9 px-5"><%= @goal.category.name unless @goal.category.nil? %></dd>
    <dt class="col-sm-3">Name:</dt>
    <dd class="col-sm-9 px-5"><%= @goal.name %></dd>
    <dt class="col-sm-3">Description:</dt>
    <dd class="col-sm-9 px-5"><%= @goal.description %></dd>
    <dt class="col-sm-3">Deadline:</dt>
    <dd class="col-sm-9 px-5"><%= @goal.deadline.to_formatted_s(:long) if @goal.deadline.present? %></dd>
  </dl>
  <div class="text-center">
    <%= form_with model: @goal do |f| %>
      <div class="mt-3">
        <%= f.label :complete %>
        <%= f.check_box :complete, {}, true %>
        <%= f.submit "#{@goal.complete? ? 'Uncomplete goal' : 'Complete goal'}", class: "mb-2 btn btn-primary btn-sm" %>
      </div>
    <% end %>
  </div>
  <div class="col-md-12 text-center">
    <%= link_to 'Back to goals', goals_path, class: "btn btn-secondary" %>
    <%= link_to "Destroy goal", @goal, data: { turbo_method: :delete, turbo_confirm: "Are you sure?" }, class: "btn btn-danger" %>
  </div>
</div>
<div class="col-sm-12 col-md-4 offset-md-1 mb-5 table">
  <div class="table-header">
    <h2 class="text-center"><%= habits_completed(@goal) %> Habits are completed</h2>
  </div>
  <div class="table-wrapper">
    <section class="table-body">
      <table class="">
        <thead class="">
          <tr>
            <th scope="col">#</th>
            <th scope="col"><%= sortable "name" %></th>
            <th scope="col">Description</th>
            <th scope="col">Complete</th>
          </tr>
        </thead>
        <tbody>
          <% @habits.each_with_index do |habit, index| %>
            <tr>
              <% unless habit.name.nil? %>
                <th scope="row"><%= index + 1 %></th>
                <td><%= link_to habit.name, edit_goal_habit_path(@goal, habit), style: "text-decoration: none" %></td>
                <td><%= habit.description.truncate(15) %></td>
                <td>
                  <%= link_to "#{habit.completed_today? ? 'completed' : 'in process'}",
                          complete_habit_path(habit),
                          class: "#{habit.completed_today? ? 'btn btn-success btn-sm' : 'btn btn-warning btn-sm'}" %>
                </td>
              <% end %>
            </tr>
          <% end %>
        </tbody>
      </table>
    </section>
    <%= link_to "Add Habit", new_goal_habit_path(@goal), class: "mt-2 btn btn-primary" %>
    <%= link_to "Show Habits", goal_habits_path(@goal), class: "mt-2 btn btn-primary" %>
  </div>
</div>
<div class="col-sm-12 col-md-4 offset-md-1 table">
  <div class="table-header">
    <h2 class="text-center"><%= tasks_complete(@goal) %> Tasks are completed</h2>
  </div>
  <div class="table-wrapper">
    <section class="table-body">
      <table class="">
        <thead class="">
          <tr>
            <th scope="col">#</th>
            <th scope="col"><%= sortable "name" %></th>
            <th scope="col">Complete</th>
          </tr>
        </thead>
        <tbody>
          <% @tasks.each_with_index do |task, index| %>
            <tr>
              <% unless task.name.nil? %>
                <th scope="row"><%= index + 1 %></th>
                <td>
                  <% if task.complete? %>
                    <%= link_to task.name.truncate(15), edit_goal_task_path(@goal, task), style: "text-decoration: line-through" %>
                  <% else %>
                    <%= link_to task.name.truncate(15), edit_goal_task_path(@goal, task), style: "text-decoration: none" %>
                  <% end %>
                </td>
              <% end %>
              <td>
                <%= link_to "#{task.complete? ? 'Unfinished task' : 'Finish task'}",
                        complete_task_path(task),
                        class: "btn btn-primary btn-sm" %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </section>
    <%= link_to "Add Task", new_goal_task_path(@goal), class: "mt-2 btn btn-primary" %>
    <%= link_to "Show Tasks", goal_tasks_path(@goal), class: "mt-2 btn btn-primary" %>
  </div>
</div>
