<% if current_user %>
  <li class="nav-item dropdown">
    <a class="nav-link nav-link-dropdown notifications-dropdown" href="#">
      <span class="badge rounded-pill bg-danger">
        <%= @unread.count >= 9 ? '9+' : @unread.count %> <i class="bi bi-bell"></i>
      </span>
    </a>

    <div class="notifications" id="notifications">
      <header>
        <div class="notif-box">
          <div class="d-flex align-items-center">
            <h2 class="title">Notifications</h2>
            <span id="notifes"><%= @unread.count %></span>
          </div>

          <p id="mark_all"><%= link_to 'Mark all as read', mark_notifications_as_read_path %></p>
        </div>
      </header>

      <div class="notifications-list">
        <% @notifications.each do |notification| %>
          <% notification = notification.to_notification %>

          <div class="notif_card <%= notification.read? ? '' : 'unread' %>">
            <div class="avatar"><%= notification.notify_avatar.decorate.gravatar css_class: 'rounded-circle' %></div>
            <div class="description">
              <p class="user_activity">
                <strong><%= notification.to_parts[:user] %></strong>
                <%= notification.to_parts[:message].truncate(30) %>
                <%= link_to notification.to_parts[:target], notification.url, class: 'strong' %>

                <%= notification.action_links if notification.respond_to? :action_links %>
              </p>
              <p class="time"><%= time_ago_in_words(notification.record.created_at) %></p>
            </div>
        </div>
        <% end %>
        
        <div class="message">
          <p>
            Hello, thanks for setting up the Chess Club. I've been a member
            for a few weeks now and I'm already having lots of fun and
            improving my game.
          </p>
        </div>
      </div>
    </div>
  </li>
<% end %>